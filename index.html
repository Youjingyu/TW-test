<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Cruise</title>
    <script>
        (function (doc, win) {
            var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
//                    if(clientWidth>=640){
//                        docEl.style.fontSize = '100px';
//                    }else{
//                        docEl.style.fontSize = 100 * (clientWidth / 640) + 'px';
//                    }
                    clientWidth = clientWidth > 1600 ? 1600 : clientWidth;
                    docEl.style.fontSize = 100 * (clientWidth / 1220) + 'px';
                };

            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <!--[if lt IE 9]>
    <script src=".js/lib/html5shiv.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/common.css">
</head>
<body>
    <div class="cr-container">
        <header class="cr-header cr-clearfix">
            <h1 class="cr-header-title">Cruise</h1>
            <div class="cr-header-right">
                <div  class="cr-member-operation">
                    <span>Signed in as </span><a href="#">Member</a>
                    <i class="cr-member-icon"></i><a href="#">Sign out</a>
                </div>
                <ul class="cr-header-nav" id="header_nav">
                    <li><a href="#">DASHBOARD</a></li>
                    <li><a href="#">MY CRUISE</a></li>
                    <li><a href="#" class="active">AGENTS</a></li>
                    <li><a href="#">HELP</a></li>
                </ul>
            </div>
        </header>
        <main class="cr-main">
            <div class="cr-main-nav cr-clearfix">
                <h3>Agents</h3>
                <ul class="cr-main-nav-list" id="main_nav">
                    <li><a href="#" data-agent-type="all">All</a></li>
                    <li><a href="#" class="active" data-agent-type="physical">Physical</a></li>
                    <li><a href="#" data-agent-type="virtual">Virtual</a></li>
                </ul>
            </div>
            <div class="cr-main-content cr-clearfix">
                <ul class="cr-main-list" id="agent_list">
                    <script type="template" id="agent_list_templ">
                        <% for( var i = 0; i < data.length; i++) { %>
                        <% if(data[i].status === 'idle'){ %>
                        <li class="cr-main-item cr-clearfix cr-main-item-idle">
                        <% }else{ %>
                        <li class="cr-main-item cr-clearfix cr-main-item-building">
                        <% } %>
                            <i></i>
                            <div class="cr-main-item-content">
                                <div class="cr-main-item-row-1">
                                    <span><%=data[i].name%></span>
                                    <span class="cr-main-item-line">|</span>
                                    <span><%=data[i].status%></span>
                                    <span class="cr-main-item-line">|</span>
                                    <span><%=data[i].ip%></span>
                                    <span class="cr-main-item-line">|</span>
                                    <span><%=data[i].path%></span>
                                </div>
                                <div class="cr-main-item-row-2">
                                    <span class="cr-main-item-add js-add-res">
                                        <i>+</i>
                                        <a href="#">Specify Resources</a>
                                    </span>
                                    <span class="cr-main-item-line">|</span>
                                    <span>Resources:</span>
                                    <div class="cr-main-item-reso">
                                        <% for(var j = 0; j < data[i].resources.length; j++) { %>
                                        <span>
                                        <%=data[i].resources[j]%><i class="cr-main-item-icon cr-main-item-delete"></i>
                                        </span>
                                        <% } %>
                                    </div>
                                    <% if(data[i].status === 'idle'){ %>
                                    <span class="cr-main-item-deny-con">
                                        <i class="cr-main-item-icon cr-main-item-deny"></i>
                                        <a href="#">Deny</a>
                                    </span>
                                    <% } %>
                                </div>
                            </div>
                            <div class="cr-main-add-dialog">
                                <span>(separate multiple resources name with commas)</span>
                                <input>
                                <div>
                                    <button class="js-dialog-add">Add resources</button>
                                    <button class="js-dialog-close">Close</button>
                                </div>
                                <div class="cr-main-triangle"></div>
                            </div>
                        </li>
                        <% } %>
                    </script>
                </ul>
                <div class="cr-main-summary-con">
                    <div class="cr-main-summary">
                        <h4>Summary</h4>
                        <ul>
                            <script type="template" id="summary_templ">
                                <li><span class="cr-main-summary-status">building</span><span><%=data.building%></span></li>
                                <li><span class="cr-main-summary-status">idle</span><span><%=data.idle%></span></li>
                            </script>
                        </ul>
                    </div>
                    <div class="cr-main-summary">
                        <h4>History</h4>
                        <ul>
                            <script type="template" id="history_list_templ">
                                <% for( var i = 0; i < data.length; i++) { %>
                                <li title="bjstdmngbgr02/Acceptance_test"><%=data[i]%></li>
                                <% } %>
                            </script>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
<script src="./js/dom-wrap.js"></script>
<script src="./js/template.js"></script>
<script src="./js/data.js"></script>
<script src="./js/common.js"></script>
<script>
    (function () {
        // config js hook
        var js_hook = {
            header_nav: '#header_nav',
            main_nav: '#main_nav',
            agent_list: '#agent_list',
            add_res: '.js-add-res',
            delete_res: '.cr-main-item-delete',
            dialog: '.cr-main-add-dialog',
            dialog_close: '.js-dialog-close',
            dialog_add: '.js-dialog-add',
            res_container: '.cr-main-item-reso'
        }
        Cr.js_hook = js_hook;

        var $header_nav = Cr.getEle(js_hook.header_nav);
        $header_nav.on('click', 'a', function () {
            var $this = Cr.wrap(this);
            if(!$this.hasClass('active')){
                $header_nav.getEle('.active')[0].removeClass('active');
                $this.addClass('active');
                // TODO: page switch
            }
        });

        var $main_nav = Cr.getEle(js_hook.main_nav);
        Cr.agent_type = $main_nav.getEle('.active')[0].getAttribute('data-agent-type');
        $main_nav.on('click', 'a', function () {
            var $this = Cr.wrap(this);
            if(!$this.hasClass('active')){
                $main_nav.getEle('.active')[0].removeClass('active');
                $this.addClass('active');
                Cr.agent_type = this.getAttribute('data-agent-type');
                Cr.refreshList(Cr.agent_type, addAgentListEvent);
            }
        });

        var $agent_list = Cr.getEle(js_hook.agent_list);
        // delete resources
        $agent_list.on('click', js_hook.delete_res, function () {
            Cr.deleteRes(this.parentNode);
        });
        // show dialog
        $agent_list.on('click', js_hook.add_res, function () {
            this.parentNode.parentNode.nextSibling.nextSibling.setAttribute('style', 'display: block');
        });

        Cr.refreshList(Cr.agent_type, addAgentListEvent);

        function addAgentListEvent() {
            var $dialogs = Cr.getEle(js_hook.dialog);
            // hide dialog
            $dialogs.on('click', js_hook.dialog_close, function () {
                this.parentNode.parentNode.setAttribute('style', 'display: none');
            });
            // dialog add
            $dialogs.on('click', js_hook.dialog_add, function () {
                var $dialog = Cr.wrap(this.parentNode.parentNode);
                var $input = $dialog.getEle('input')[0];
                var resources = $input.value.split(/[ ]*,[ ]*/);
                Cr.addRes($dialog.parentNode, resources);
                $input.value = ''
                $dialog.setAttribute('style', 'display: none');
            });
        }
    })()
</script>
</html>